{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\99kyl\\\\ListenTogether\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\99kyl\\\\ListenTogether\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\99kyl\\\\ListenTogether\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\99kyl\\\\ListenTogether\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{connect}from'react-redux';import{bindActionCreators}from\"redux\";import{authEndpoint,clientId,redirectUri,scopes}from\"../config\";import{hasLoaded}from\"../actions/uiActions\";import'../styles/Group.css';import topLeft from'../topLeft.png';import topRight from'../topRight.png';import Player from'./Player.js';import SpotifyPlayer from'react-spotify-web-playback';import $ from\"jquery\";import{confirmAlert}from'react-confirm-alert';import'react-confirm-alert/src/react-confirm-alert.css';var Group=/*#__PURE__*/function(_Component){_inherits(Group,_Component);var _super=_createSuper(Group);function Group(){var _this;_classCallCheck(this,Group);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={data:[],intervalIsSet:false,ownerToken:\"\",item:{album:{images:[{url:\"\"}]},name:\"\",artists:[{name:\"\"}],duration_ms:0},userUri:[],ownerPlaying:[],uri:\"\",sync:false,position:0};_this.getDataFromDb=function(){fetch('https://listen-together-api.herokuapp.com/Groups/getData').then(function(data){return data.json();}).then(function(res){return _this.setState({data:res});});};return _this;}_createClass(Group,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.getDataFromDb();if(!this.state.intervalIsSet){var interval=setInterval(this.getDataFromDb,1000);this.setState({intervalIsSet:interval});}if(this.state.data.length>0){var curGroup=this.state.data.find(function(element){return element.group===_this2.props.group;});this.setState({ownerToken:curGroup.ownerToken});this.getCurrentlyPlaying(this.state.ownerToken);}window.onbeforeunload=function(){this.onUnload();return\"\";}.bind(this);this.props.hasLoaded(true);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.state.intervalIsSet){clearInterval(this.state.intervalIsSet);this.setState({intervalIsSet:null});}this.props.hasLoaded(false);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){// Keep members tracks synced\nif(!this.props.isOwner&&this.state.ownerPlaying.length!==0){console.log(\"CUR URI: \"+this.state.userUri[0]);if(this.state.userUri.length===0){this.getURI(this.props.token);}else if(this.state.userUri[0]!==this.state.uri&&this.state.sync){this.SyncSongs(this.props.token);}}}},{key:\"displayOwner\",value:function displayOwner(){var _this3=this;var curGroup=this.state.data.find(function(element){return element.group===_this3.props.group;});return curGroup.ownerName;}},{key:\"SyncSongs\",value:function SyncSongs(token){var _this4=this;$.ajax({url:\"https://api.spotify.com/v1/me/player/play\",type:\"PUT\",data:JSON.stringify({\"uris\":this.state.ownerPlaying,\"position_ms\":this.state.position}),beforeSend:function beforeSend(xhr){xhr.setRequestHeader(\"Authorization\",\"Bearer \"+token);},success:function success(){_this4.getURI(_this4.props.token);_this4.setState({sync:false});console.log(\"Songs Synced\");}});}},{key:\"getURI\",value:function getURI(token){var _this5=this;$.ajax({url:\"https://api.spotify.com/v1/me/player\",type:\"GET\",beforeSend:function beforeSend(xhr){xhr.setRequestHeader(\"Authorization\",\"Bearer \"+token);},success:function success(data){if(typeof data!=='undefined'){if(data===null||data===void 0?void 0:data.item){_this5.setState({userUri:[data.item.uri]});}else{_this5.setState({userUri:[\"Not Playing\"]});}}}});}// TODO change to componentDidUpdate\n},{key:\"getCurrentlyPlaying\",value:function getCurrentlyPlaying(token){var _this6=this;$.ajax({url:\"https://api.spotify.com/v1/me/player\",type:\"GET\",beforeSend:function beforeSend(xhr){xhr.setRequestHeader(\"Authorization\",\"Bearer \"+token);},success:function success(data){if(typeof data!=='undefined'){var newSong=[data.item.uri];if(data.item.uri!==_this6.state.uri){_this6.setState({item:data.item,uri:data.item.uri,ownerPlaying:newSong,sync:true,position:data.progress_ms});}}else if(!_this6.props.isOwner){confirmAlert({title:'No Music Playing',message:'The group leader needs to start playing music to begin.',buttons:[{label:'OK'}]});}}});}},{key:\"render\",value:function render(){if(!this.props.isLoaded){return/*#__PURE__*/React.createElement(\"div\",{className:\"Group\"},/*#__PURE__*/React.createElement(\"header\",{className:\"Group-header\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"Group-title\"},\"Listen Together\"),/*#__PURE__*/React.createElement(\"img\",{src:topLeft,className:\"Group-logoLeft\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"img\",{src:topRight,className:\"Group-logoRight\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"})));}if(this.props.isLoaded&&this.state.data.length===0){return/*#__PURE__*/React.createElement(\"div\",{className:\"Group\"},/*#__PURE__*/React.createElement(\"header\",{className:\"Group-header\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"Group-title\"},\"Listen Together\"),/*#__PURE__*/React.createElement(\"img\",{src:topLeft,className:\"Group-logoLeft\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"img\",{src:topRight,className:\"Group-logoRight\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"Group-curGroup\"},\"Loading...\"),/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"Home-p\"},\"Created By Kyle Litton. \",/*#__PURE__*/React.createElement(\"a\",{className:\"Home-credit\",href:\"https://github.com/jkl1999/ListenTogether\"},\"View Source\"))));}else{if(this.props.isLoaded&&!this.props.username){return/*#__PURE__*/React.createElement(\"div\",{className:\"Group\"},/*#__PURE__*/React.createElement(\"header\",{className:\"Group-header\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"Group-title\"},\"Listen Together\"),/*#__PURE__*/React.createElement(\"img\",{src:topLeft,className:\"Group-logoLeft\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"img\",{src:topRight,className:\"Group-logoRight\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"h3\",{className:\"Group-loadError\"},\"Something Went Wrong\"),/*#__PURE__*/React.createElement(\"a\",{className:\"Group-tryAgain\",href:\"\".concat(authEndpoint,\"?client_id=\").concat(clientId,\"&redirect_uri=\").concat(redirectUri,\"&scope=\").concat(scopes.join(\"%20\"),\"&response_type=token&show_dialog=true\")},\"Try Again\")));}if(!this.props.isOwner){return/*#__PURE__*/React.createElement(\"div\",{className:\"Group\"},/*#__PURE__*/React.createElement(\"header\",{className:\"Group-header\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"Group-title\"},\"Listen Together\"),/*#__PURE__*/React.createElement(\"img\",{src:topLeft,className:\"Group-logoLeft\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"img\",{src:topRight,className:\"Group-logoRight\",alt:\"logo\"}),this.getCurrentlyPlaying(this.props.ownerToken),/*#__PURE__*/React.createElement(\"div\",{className:\"Group-player\"},console.log(this.state.uri),/*#__PURE__*/React.createElement(Player,{item:this.state.item,uri:this.state.uri}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(SpotifyPlayer,{styles:{loaderColor:'#1db954',sliderColor:'#1db954'},autoPlay:true,play:true,showSaveIcon:true,token:this.props.token,name:\"Listen Together\"}),\";\"),/*#__PURE__*/React.createElement(\"p\",{className:\"Home-p\"},\"Created By Kyle Litton. \",/*#__PURE__*/React.createElement(\"a\",{className:\"Home-credit\",href:\"https://github.com/jkl1999/ListenTogether\"},\"View Source\"))));}if(this.props.isOwner){return/*#__PURE__*/React.createElement(\"div\",{className:\"Group\"},/*#__PURE__*/React.createElement(\"header\",{className:\"Group-header\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"Group-title\"},\"Listen Together\"),/*#__PURE__*/React.createElement(\"img\",{src:topLeft,className:\"Group-logoLeft\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"img\",{src:topRight,className:\"Group-logoRight\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"Group-curGroup\"},'Current Group: '+this.props.group),this.getCurrentlyPlaying(this.props.token),/*#__PURE__*/React.createElement(\"div\",{className:\"Group-player\"},/*#__PURE__*/React.createElement(Player,{item:this.state.item,uri:this.state.uri}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(SpotifyPlayer,{styles:{loaderColor:'#1db954',sliderColor:'#1db954'},autoPlay:true,play:true,showSaveIcon:true,token:this.props.token,name:\"Listen Together\"}),\";\"),/*#__PURE__*/React.createElement(\"p\",{className:\"Home-p\"},\"Created By Kyle Litton. \",/*#__PURE__*/React.createElement(\"a\",{className:\"Home-credit\",href:\"https://github.com/jkl1999/ListenTogether\"},\"View Source\"))));}}}}]);return Group;}(Component);var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({hasLoaded:hasLoaded},dispatch);};var mapStateToProps=function mapStateToProps(state){return{isLoaded:state.uiReducer.isLoaded,group:state.userReducer.group,token:state.userReducer.token,username:state.userReducer.username,isOwner:state.userReducer.isOwner,ownerToken:state.userReducer.ownerToken};};export default connect(mapStateToProps,mapDispatchToProps)(Group);","map":{"version":3,"sources":["C:/Users/99kyl/ListenTogether/src/components/Group.js"],"names":["React","Component","connect","bindActionCreators","authEndpoint","clientId","redirectUri","scopes","hasLoaded","topLeft","topRight","Player","SpotifyPlayer","$","confirmAlert","Group","state","data","intervalIsSet","ownerToken","item","album","images","url","name","artists","duration_ms","userUri","ownerPlaying","uri","sync","position","getDataFromDb","fetch","then","json","res","setState","interval","setInterval","length","curGroup","find","element","group","props","getCurrentlyPlaying","window","onbeforeunload","onUnload","bind","clearInterval","isOwner","console","log","getURI","token","SyncSongs","ownerName","ajax","type","JSON","stringify","beforeSend","xhr","setRequestHeader","success","newSong","progress_ms","title","message","buttons","label","isLoaded","username","join","loaderColor","sliderColor","mapDispatchToProps","dispatch","mapStateToProps","uiReducer","userReducer"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport { authEndpoint, clientId, redirectUri, scopes } from \"../config\";\r\nimport { hasLoaded } from \"../actions/uiActions\";\r\nimport '../styles/Group.css';\r\nimport topLeft from '../topLeft.png';\r\nimport topRight from '../topRight.png';\r\nimport Player from './Player.js';\r\nimport SpotifyPlayer from 'react-spotify-web-playback';\r\nimport $ from \"jquery\";\r\nimport { confirmAlert } from 'react-confirm-alert'; \r\nimport 'react-confirm-alert/src/react-confirm-alert.css';\r\n\r\nclass Group extends Component{\r\n\r\n    state = {\r\n      data: [],\r\n      intervalIsSet:false,\r\n      ownerToken: \"\",\r\n      item: {\r\n        album: {\r\n          images: [{ url: \"\" }]\r\n        },\r\n        name: \"\",\r\n        artists: [{ name: \"\" }],\r\n        duration_ms: 0\r\n      },\r\n      userUri: [],\r\n      ownerPlaying: [],\r\n      uri: \"\",\r\n      sync: false,\r\n      position: 0\r\n    }\r\n\r\n    componentDidMount() { \r\n      this.getDataFromDb();   \r\n        if (!this.state.intervalIsSet) {\r\n          let interval = setInterval(this.getDataFromDb, 1000);\r\n          this.setState({ intervalIsSet: interval });\r\n        }\r\n        if(this.state.data.length>0){\r\n          let curGroup = this.state.data.find(element => element.group === this.props.group);\r\n          this.setState({ownerToken:curGroup.ownerToken});\r\n          this.getCurrentlyPlaying(this.state.ownerToken);\r\n        }\r\n        window.onbeforeunload = function() {\r\n          this.onUnload();\r\n          return \"\";\r\n        }.bind(this);\r\n        this.props.hasLoaded(true);\r\n      }\r\n    \r\n    componentWillUnmount() {\r\n        if (this.state.intervalIsSet) {\r\n          clearInterval(this.state.intervalIsSet);\r\n          this.setState({ intervalIsSet: null });\r\n        }\r\n        this.props.hasLoaded(false);\r\n      }\r\n\r\n    componentDidUpdate(){\r\n        // Keep members tracks synced\r\n        if(!this.props.isOwner && this.state.ownerPlaying.length !== 0){\r\n          console.log(\"CUR URI: \" + this.state.userUri[0]);\r\n\r\n          if(this.state.userUri.length===0){\r\n            this.getURI(this.props.token);\r\n          }        \r\n          else if(this.state.userUri[0] !== this.state.uri && this.state.sync){\r\n            this.SyncSongs(this.props.token);\r\n          }\r\n          \r\n        }\r\n    }\r\n    \r\n      getDataFromDb = () => {\r\n        fetch('https://listen-together-api.herokuapp.com/Groups/getData')\r\n          .then((data) => data.json())\r\n          .then((res) => this.setState({ data: res }));\r\n      };\r\n\r\n      displayOwner(){\r\n        let curGroup = this.state.data.find(element => element.group === this.props.group);\r\n        return curGroup.ownerName;\r\n      }\r\n\r\n      SyncSongs(token){\r\n        $.ajax({\r\n          url: \"https://api.spotify.com/v1/me/player/play\",\r\n          type: \"PUT\",\r\n          data: JSON.stringify({\"uris\":this.state.ownerPlaying, \"position_ms\":this.state.position}),\r\n          beforeSend: xhr => {\r\n            xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n          },\r\n          success: () => {\r\n            this.getURI(this.props.token);\r\n            this.setState({sync:false});\r\n            console.log(\"Songs Synced\");\r\n          }\r\n        });\r\n      }\r\n\r\n      getURI(token){\r\n        $.ajax({\r\n          url: \"https://api.spotify.com/v1/me/player\",\r\n          type: \"GET\",\r\n          beforeSend: xhr => {\r\n            xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n          },\r\n          success: data => {\r\n            if(typeof data !== 'undefined'){\r\n              if(data?.item){\r\n                this.setState(\r\n                {\r\n                  userUri : [data.item.uri]\r\n                }\r\n              )\r\n              }else{\r\n                this.setState(\r\n                  {\r\n                    userUri : [\"Not Playing\"]\r\n                  }\r\n                )\r\n              }             \r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      // TODO change to componentDidUpdate\r\n      getCurrentlyPlaying(token) {\r\n          $.ajax({\r\n            url: \"https://api.spotify.com/v1/me/player\",\r\n            type: \"GET\",\r\n            beforeSend: xhr => {\r\n              xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n            },\r\n            success: data => {\r\n              if(typeof data !== 'undefined'){\r\n                \r\n                const newSong = [data.item.uri];\r\n                  if(data.item.uri !== this.state.uri){\r\n                  this.setState({\r\n                    item: data.item,\r\n                    uri : data.item.uri,\r\n                    ownerPlaying : newSong,\r\n                    sync: true,\r\n                    position: data.progress_ms\r\n                  });\r\n                }\r\n              }\r\n              else if(!this.props.isOwner){\r\n                confirmAlert({\r\n                  title: 'No Music Playing',\r\n                  message: 'The group leader needs to start playing music to begin.',\r\n                  buttons: [{label: 'OK'}]\r\n                });\r\n              }\r\n            }\r\n          });\r\n      }\r\n\r\n      render() {\r\n\r\n        if(!this.props.isLoaded){\r\n          return(\r\n          <div className=\"Group\">\r\n            <header className=\"Group-header\">\r\n            <h1 className=\"Group-title\">Listen Together</h1>\r\n                <img src={topLeft} className=\"Group-logoLeft\" alt=\"logo\"/>\r\n                <img src={topRight} className=\"Group-logoRight\" alt=\"logo\"/>\r\n            <div className=\"loader\"></div>\r\n            </header>\r\n          </div>\r\n          )\r\n        }\r\n        if(this.props.isLoaded && this.state.data.length === 0){\r\n          return(\r\n          <div className=\"Group\">\r\n            <header className=\"Group-header\">\r\n            <h1 className=\"Group-title\">Listen Together</h1>\r\n            <img src={topLeft} className=\"Group-logoLeft\" alt=\"logo\"/>\r\n            <img src={topRight} className=\"Group-logoRight\" alt=\"logo\"/>\r\n\r\n            <p className=\"Group-curGroup\">Loading...</p>\r\n            <div className=\"loader\"></div>\r\n          \r\n            <p className=\"Home-p\">\r\n            Created By Kyle Litton. <a className=\"Home-credit\" href='https://github.com/jkl1999/ListenTogether'>View Source</a>\r\n            </p>\r\n            </header>\r\n            \r\n          </div>\r\n          )\r\n        }\r\n        else{\r\n          if(this.props.isLoaded && !this.props.username){\r\n            return(\r\n              <div className=\"Group\">\r\n                <header className=\"Group-header\">\r\n                <h1 className=\"Group-title\">Listen Together</h1>\r\n                    <img src={topLeft} className=\"Group-logoLeft\" alt=\"logo\"/>\r\n                    <img src={topRight} className=\"Group-logoRight\" alt=\"logo\"/>\r\n                <h3 className=\"Group-loadError\">Something Went Wrong</h3>\r\n                <a\r\n              className=\"Group-tryAgain\"\r\n              href={`${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join(\r\n                \"%20\"\r\n              )}&response_type=token&show_dialog=true`}\r\n            >\r\n              Try Again\r\n            </a>\r\n                </header>\r\n              </div>\r\n              )\r\n          }\r\n          if(!this.props.isOwner){\r\n            return (\r\n              <div className=\"Group\">\r\n                <header className=\"Group-header\">\r\n                <h1 className=\"Group-title\">Listen Together</h1>\r\n                <img src={topLeft} className=\"Group-logoLeft\" alt=\"logo\"/>\r\n                <img src={topRight} className=\"Group-logoRight\" alt=\"logo\"/> \r\n                {this.getCurrentlyPlaying(this.props.ownerToken)}\r\n                <div className='Group-player'>\r\n                    {console.log(this.state.uri)}\r\n                    <Player\r\n                      item={this.state.item}\r\n                      uri={this.state.uri}\r\n                      />\r\n                      <br></br>\r\n                      <br></br>\r\n                      <SpotifyPlayer\r\n                      styles={{\r\n                        loaderColor: '#1db954',\r\n                        sliderColor: '#1db954',\r\n                      }}\r\n                      autoPlay\r\n                      play={true}\r\n                      showSaveIcon={true}\r\n                      token={this.props.token}          \r\n                      name = \"Listen Together\"\r\n                      />;\r\n                  </div>\r\n                <p className=\"Home-p\">\r\n                Created By Kyle Litton. <a className=\"Home-credit\" href='https://github.com/jkl1999/ListenTogether'>View Source</a>\r\n                </p>\r\n                </header>\r\n                \r\n              </div>\r\n            );\r\n          }\r\n          if(this.props.isOwner){\r\n            return (\r\n              <div className=\"Group\">\r\n                <header className=\"Group-header\">\r\n                <h1 className=\"Group-title\">Listen Together</h1>\r\n                <img src={topLeft} className=\"Group-logoLeft\" alt=\"logo\"/>\r\n                <img src={topRight} className=\"Group-logoRight\" alt=\"logo\"/>\r\n  \r\n                <p className=\"Group-curGroup\">{'Current Group: ' + this.props.group}</p>\r\n                {this.getCurrentlyPlaying(this.props.token)}           \r\n                  <div className='Group-player'>\r\n                    <Player\r\n                      item={this.state.item}\r\n                      uri={this.state.uri}\r\n                      />\r\n                      <br></br>\r\n                      <br></br>\r\n                      <SpotifyPlayer\r\n                      styles={{\r\n                        loaderColor: '#1db954',\r\n                        sliderColor: '#1db954',\r\n                      }}\r\n                      autoPlay\r\n                      play={true}\r\n                      showSaveIcon={true}\r\n                      token={this.props.token}          \r\n                      name = \"Listen Together\"\r\n                      />;\r\n                  </div>\r\n                <p className=\"Home-p\">\r\n                Created By Kyle Litton. <a className=\"Home-credit\" href='https://github.com/jkl1999/ListenTogether'>View Source</a>\r\n                </p>\r\n                </header>\r\n                \r\n              </div>\r\n            );\r\n          }        \r\n        }\r\n      }\r\n\r\n\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators(\r\n    {\r\n      hasLoaded\r\n    },\r\n    dispatch\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n      isLoaded: state.uiReducer.isLoaded,\r\n      group: state.userReducer.group,\r\n      token: state.userReducer.token,\r\n      username: state.userReducer.username,\r\n      isOwner: state.userReducer.isOwner,\r\n      ownerToken: state.userReducer.ownerToken\r\n    };\r\n  };\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Group);"]},"metadata":{},"sourceType":"module"}